## 1、请解释一下什么是`Nginx`?

Nginx 是一个 web 服务器和反向代理服务器，用于`HTTP`、`HTTPS`、`SMTP`、`POP3`和`IMAP`协议。

**2、为什么要用 Nginx？**
优点：
跨平台、配置简单
非阻塞、高并发连接：处理 2-3 万并发连接数，官方监测能支持 5 万并发
内存消耗小：开启 10 个 nginx 才占 150M 内存，Nginx 采取了分阶段[资源分配](https://baike.so.com/doc/1092243-1155769.html)技术
nginx 处理静态文件好, 耗费内存少
内置的健康检查功能：如果有一个服务器宕机，会做一个健康检查，再发送的请求就不会发送到宕机的服务器了。重新将请求提交到其他的节点上。
节省宽带：支持 GZIP 压缩，可以添加浏览器本地缓存
稳定性高：宕机的概率非常小
master/worker 结构：一个 master 进程，生成一个或者多个 worker 进程
接收用户请求是异步的：浏览器将请求发送到 nginx 服务器，它先将用户请求全部接收下来，再一次性发送给后端 web 服务器，极大减轻了 web 服务器的压力
一边接收 web 服务器的返回数据，一边发送给浏览器客户端
网络依赖性比较低，只要 ping 通就可以负载均衡
可以有多台 nginx 服务器
事件驱动：通信机制采用 epoll 模型

**3、为什么 Nginx 性能这么高？**
得益于它的事件处理机制：
异步非阻塞事件处理机制：运用了 epoll 模型，提供了一个队列，排队解决

**4、为什么不使用多线程？**

Apache: 创建多个进程或线程，而每个进程或线程都会为其分配 cpu 和内存（线程要比进程小的多，所以 worker 支持比 perfork 高的并发），并发过大会榨干服务器资源。

Nginx: 采用单线程来异步非阻塞处理请求（管理员可以配置 Nginx 主进程的工作进程的数量）(epoll)，不会为每个请求分配 cpu 和内存资源，节省了大量资源，同时也减少了大量的 CPU 的上下文切换。所以才使得 Nginx 支持更高的并发。

**5、Nginx 是如何处理一个请求的呢？**
首先，nginx 在启动时，会解析配置文件，得到需要监听的端口与 ip 地址，然后在 nginx 的 master 进程里面
先初始化好这个监控的 socket，再进行 listen
然后再 fork 出多个子进程出来, 子进程会竞争 accept 新的连接。

此时，客户端就可以向 nginx 发起连接了。当客户端与 nginx 进行三次握手，与 nginx 建立好一个连接后

此时，某一个子进程会 accept 成功，然后创建 nginx 对连接的封装，即 ngx_connection_t 结构体
接着，根据事件调用相应的事件处理模块，如 http 模块与客户端进行数据的交换。

最后，nginx 或客户端来主动关掉连接，到此，一个连接就寿终正寝了

**6、正向代理**
一个位于客户端和原始服务器 (origin server) 之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标 (原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端才能使用正向代理
正向代理总结就一句话：**代理端代理的是客户端**
**7、反向代理**
反向代理（Reverse Proxy）方式是指以代理服务器来接受 internet 上的连接请求，然后将请求，发给内部网络上的服务器
并将从服务器上得到的结果返回给 internet 上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器
反向代理总结就一句话：**代理端代理的是服务端**
**8、动态资源、静态资源分离**
动态资源、静态资源分离是让动态网站里的动态网页根据一定规则把不变的资源和经常变的资源区分开来，动静资源做好了拆分以后，我们就可以根据静态资源的特点将其做缓存操作，这就是网站静态化处理的核心思路
动态资源、静态资源分离简单的概括是：动态文件与静态文件的分离
**9、为什么要做动、静分离？**
在我们的软件开发中，有些请求是需要后台处理的（如：.jsp,.do 等等），有些请求是不需要经过后台处理的（如：css、html、jpg、js 等等文件）
这些不需要经过后台处理的文件称为静态文件，否则动态文件。因此我们后台处理忽略静态文件。这会有人又说那我后台忽略静态文件不就完了吗
当然这是可以的，但是这样后台的请求次数就明显增多了。在我们对资源的响应速度有要求的时候，我们应该使用这种动静分离的策略去解决
动、静分离将网站静态资源（HTML，JavaScript，CSS，img 等文件）与后台应用分开部署，提高用户访问静态代码的速度，降低对后台应用访问
这里我们将静态资源放到 nginx 中，动态资源转发到 tomcat 服务器中

**10、负载均衡**
负载均衡即是代理服务器将接收的请求均衡的分发到各服务器中
负载均衡主要解决网络拥塞问题，提高服务器响应速度，服务就近提供，达到更好的访问质量，减少后台服务器大并发压力

```
server {
listen 80;
server_name localhost;
access_log /home/ubuntu/nginx.log;
error_log /home/ubuntu/nginx.error.log debug;
error_page 403 /404.html;
location = /404.html {
root /urs/local/nginx/html;
}
root /data/dist;
index index.html;

location /api/ { # 要拦截的请求
proxy_pass http://ip:60000/api/;
}
location / {
try_files $uri $uri/ @router;
index index.html; 
} 
location @router {
rewrite ^.*$ /index.html last;
}
}
```

